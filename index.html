<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Ball Universe - Search Engine</title>

    <!-- Ícono -->
    <link rel="icon" type="image/png" href="lupa2.png">

    <!-- Estilos -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <!-- Cabecera -->
    <header class="header row justify-content-center align-items-center">
      <div class="col-6">
        <button class="reset align-items-center" id="resetBtn">
          <img src="reset.png" alt="Lupa Icono" class="icono-pequeño">Reset
        </button>
      </div>
      <div class="col-6">
        <p class="creditos-header">
          Hecho con
          <img src="https://freesvg.org/img/1646656079PixelArt-Heart-1.png" alt="Corazón pixelado" class="pixel-heart">
          por Chao, Nicolás y Álvaro –
          <a href="https://github.com/ChaoAlarcon/Dragon-Ball-API" target="_blank">Repositorio en GitHub</a>
        </p>
      </div>
    </header>

    <!-- Contenido principal -->
    <section class="container">
      <!-- Título principal -->
      <div class="big-title row align-items-center Título">
        <div class="window-titlebar">
          <span class="title">Mensaje del sistema</span>
          <button class="cerrar" onclick="hideTitle()">X</button>
        </div>
        <h1 class="text-xl-center title mt-2 mb-4">
          <img src="lupa.png" alt="Lupa Icono" class="icono">
          Dragon Ball Universe - DataBase
        </h1>
      </div>

      <!-- Botones de modales -->
      <div class="big-title row align-items-center Subtítulo">
        <div class="window-titlebar">
          <span class="title">Mensaje del sistema</span>
          <button class="cerrar" onclick="hideTitle2()">X</button>
        </div>
        <button class="Botones-centrales border-5 rounded-0 col-3" data-bs-toggle="modal" data-bs-target="#seriesModal">
          <h2>Series</h2>
        </button>
        <button class="Botones-centrales border-5 rounded-0 col-3" data-bs-toggle="modal" data-bs-target="#autorModal">
          <h2>Autor</h2>
        </button>
        <button class="Botones-centrales border-5 rounded-0 col-3" data-bs-toggle="modal" data-bs-target="#creditsModal">
          <h2>Créditos</h2>
        </button>
      </div>

      <!-- Buscador -->
      <div class="big-title2 text-center mb-4 align-items-center">
        <input class="buscador form-text input-group-lg border-5 rounded-0 col-9" id="name" type="text" placeholder="Nombre del personaje" style="font-size: 1.5rem;" />
      </div>

      <!-- Filtros -->
      <div class="filters row">
        <select class="form-select form-select-lg border-5 rounded-0 col-1" id="race">
          <option value="">Raza</option>
          <option value="Saiyan">Saiyan</option>
          <option value="Human">Humano</option>
          <option value="Namekian">Namekiano</option>
          <option value="Android">Androide</option>
        </select>

        <select class="form-select form-select-lg border-5 rounded-0 col-1" id="gender">
          <option value="">Género</option>
          <option value="Male">Masculino</option>
          <option value="Female">Femenino</option>
        </select>

        <button class="border-5 rounded-0 col-4" onclick="searchCharacters()">Buscar</button>
      </div>

      <!-- Resultados -->
      <div id="results" class="results"></div>

      <!-- Paginación -->
      <div id="pagination" class="pagination"></div>

      <!-- Modales -->
      <!-- Series -->
      <!-- Autor -->
      <!-- Créditos -->
      <!-- (Continúa más abajo) -->
    </section>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


  <!-- Script principal -->
  <script>
   // Variables globales
let personajesTotales = []; // Almacena todos los personajes
let paginaActual = 1; // Página actual
const elementosPorPagina = 20; // Número de personajes por página

// Función para obtener todos los personajes desde la API paginada
async function obtenerTodosLosPersonajes() {
  let personajes = [];
  let pagina = 1;
  let hayMas = true;

  while (hayMas) {
    const respuesta = await fetch(`https://dragonball-api.com/api/characters?page=${pagina}`);
    const datos = await respuesta.json();

    if (datos.items && datos.items.length > 0) {
      personajes = personajes.concat(datos.items);
      pagina++;
    } else {
      hayMas = false;
    }
  }

  return personajes;
}

// Función principal de búsqueda y filtrado
async function filtrarPersonajes() {
  const nombre = document.getElementById('name').value.toLowerCase();
  const raza = document.getElementById('race').value;
  const genero = document.getElementById('gender').value;

  if (personajesTotales.length === 0) {
    personajesTotales = await obtenerTodosLosPersonajes();
  }

  const filtrados = personajesTotales.filter(personaje => {
    return (!nombre || personaje.name.toLowerCase().includes(nombre)) &&
           (!raza || personaje.race === raza) &&
           (!genero || personaje.gender === genero);
  });

  mostrarResultados(filtrados);
}

// Muestra los personajes en la interfaz
function mostrarResultados(personajes) {
  const contenedorResultados = document.getElementById('results');
  contenedorResultados.innerHTML = '';

  const inicio = (paginaActual - 1) * elementosPorPagina;
  const fin = inicio + elementosPorPagina;
  const personajesPagina = personajes.slice(inicio, fin);

  if (personajesPagina.length === 0) {
    contenedorResultados.innerHTML = '<p>No se encontraron personajes.</p>';
    return;
  }

  personajesPagina.forEach(personaje => {
    const tarjeta = document.createElement('div');
    tarjeta.className = 'window carta-personaje card soft-shadow m-3';
    tarjeta.style.width = '300px';
    tarjeta.style.padding = '0';

    tarjeta.innerHTML = `
      <div class="window-titlebar" style="background-color: #0078d7;">
        <span class="title" style="font-size: 20px;">${personaje.name.toUpperCase()}</span>
        <button class="cerrar" data-bs-dismiss="modal" onclick="cerrarTarjeta(this)">X</button>
      </div>
      <div class="card-body text-center" style="background-color:#fefefe; padding: 15px; border-top: 2px inset white; border-left: 2px inset white; border-right: 2px inset gray; border-bottom: 2px inset gray;">
        <img src="${personaje.image}" alt="${personaje.name}" style="width: 100px; height: auto; margin-bottom: 15px;">
        <p style="font-family: 'Press Start 2P', monospace; font-size: 20px; margin: 10px 0;">Raza: ${personaje.race}</p>
        <p style="font-family: 'Press Start 2P', monospace; font-size: 20px;">Género: ${personaje.gender}</p>
      </div>
    `;

    contenedorResultados.appendChild(tarjeta);
  });

  generarPaginacion(personajes.length);
}

// Crea la paginación
function generarPaginacion(totalElementos) {
  const totalPaginas = Math.ceil(totalElementos / elementosPorPagina);
  const paginacion = document.getElementById('pagination');
  paginacion.innerHTML = '';

  if (totalPaginas > 1) {
    const contenedor = document.createElement('div');
    contenedor.className = 'd-flex justify-content-center gap-2 flex-wrap w-100';

    for (let i = 1; i <= totalPaginas; i++) {
      const boton = document.createElement('button');
      boton.textContent = i;
      boton.className = 'border-5 rounded-0';
      boton.onclick = () => {
        paginaActual = i;
        filtrarPersonajes();
      };

      if (i === paginaActual) {
        boton.style.fontWeight = 'bold';
      }

      contenedor.appendChild(boton);
    }

    const contenedorCentral = document.createElement('div');
    contenedorCentral.className = 'd-flex justify-content-center w-100';
    contenedorCentral.appendChild(contenedor);

    paginacion.appendChild(contenedorCentral);
  }
}

// Alterna visibilidad del título principal
function alternarTitulo() {
  const titulo = document.querySelector('.Título');
  titulo.classList.toggle('hidden');
}

// Alterna visibilidad de la sección de modales
function alternarSubtitulo() {
  const subtitulo = document.querySelector('.Subtítulo');
  subtitulo.classList.toggle('hidden2');
}

// Cierra una tarjeta con animación
function cerrarTarjeta(boton) {
  const tarjeta = boton.closest('.card');
  if (tarjeta) {
    tarjeta.style.transition = 'opacity 0.2s ease-out';
    tarjeta.style.opacity = '0';
  }
}

// Botón para reiniciar la búsqueda
document.getElementById('resetBtn').addEventListener('click', () => {
  window.location.reload();
});

  </script>
</body>
<footer class="bg-dark text-light text-center p-4 mt-5 w-100">
  <div class="container">
    <p class="mb-2">Proyecto destacado: <strong>Dragon Ball API</strong></p>
    <a href="https://github.com/ChaoAlarcon/Dragon-Ball-API" target="_blank" class="btn btn-outline-light btn-sm">
      <i class="bi bi-github"></i> Ver repositorio en GitHub
    </a>
    <p class="mt-3 mb-0">&copy; 2025 Chao An Alarcón Chen. Todos los derechos reservados.</p>
  </div>
</footer>


</html>