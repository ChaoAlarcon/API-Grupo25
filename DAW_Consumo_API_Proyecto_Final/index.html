<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dragon Ball DataBase</title>
  <link rel="icon" type="image/png" href="ico.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
 
</head>
<body>
  <section class="container">
    <h1 class="text-xl-center" ><img src="lupa.png" alt="Lupa Icono" class="icono">Dragon Ball DataBase</h1>
    <div class="text-center mb-4 align-items-center">
     
      
     <input class="buscador form-text input-group-lg border-5 rounded-0 col-8" type="text" id="name" placeholder="Nombre del personaje" style="font-size: 1.5rem; " />
     </div>
    <div class="filters row">
     
      <select class="form-select   form-select-lg border-5 rounded-0 col-1" id="race">
        <option class=" border-5 rounded-0" value="">Raza</option>
        <option class="border-5 rounded-0" value="Saiyan">Saiyan</option>
        <option class="border-5 rounded-0" value="Human">Humano</option>
        <option class="border-5 rounded-0" value="Namekian">Namekiano</option>
        <option class="border-5 rounded-0" value="Android">Androide</option>
      </select>
      <select class="form-select form-select-lg border-5 rounded-0 col-1" id="gender">
        <option class="border-5 rounded-0" value="">Género</option>
        <option class="border-5 rounded-0" value="Male">Masculino</option>
        <option class="border-5 rounded-0" value="Female">Femenino</option>
      </select>
      <button class="btn btn-danger btn-lg border-5 rounded-0 col-4" onclick="searchCharacters()">Buscar</button>
    </div>
    <div id="results" class="results"></div>
    <div class="pagination" id="pagination"></div>
  </section>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    let allCharacters = [];
    let currentPage = 1;
    const itemsPerPage = 20;

    async function fetchAllCharacters() {
      let characters = [];
      let page = 1;
      let hasMore = true;

      while (hasMore) {
        const response = await fetch(`https://dragonball-api.com/api/characters?page=${page}`);
        const data = await response.json();
        if (data.items && data.items.length > 0) {
          characters = characters.concat(data.items);
          page++;
        } else {
          hasMore = false;
        }
      }

      return characters;
    }

    async function searchCharacters() {
      const name = document.getElementById('name').value.toLowerCase();
      const race = document.getElementById('race').value;
      const gender = document.getElementById('gender').value;

      if (allCharacters.length === 0) {
        allCharacters = await fetchAllCharacters();
      }

      const filtered = allCharacters.filter(char => {
        return (!name || char.name.toLowerCase().includes(name)) &&
               (!race || char.race === race) &&
               (!gender || char.gender === gender);
      });

      displayResults(filtered);
    }

    function displayResults(characters) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageItems = characters.slice(start, end);

      if (pageItems.length === 0) {
        resultsDiv.innerHTML = '<p>No se encontraron personajes.</p>';
        return;
      }

      pageItems.forEach(char => {
        const card = document.createElement('div');
        card.className = 'card card border-5 rounded-0';
        card.innerHTML = `<div class="card-header"><h3 class="card-title">${char.name}</h3></div>
        <div class="card-body d-flex flex-column align-items-center">
          <img class="card-img align-items-center" src="${char.image}" alt="${char.name}" /></div>
        
          
          <p class="card-text">Raza: ${char.race}</p>
          <p class="card-footer">Género: ${char.gender}</p>
          </div>
        `;
        resultsDiv.appendChild(card);
      });

      generatePagination(characters.length);
    }

    function generatePagination(totalItems) {
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';

      if (totalPages > 1) {
        const wrapper = document.createElement('div');
        wrapper.className = 'd-flex justify-content-center gap-2 flex-wrap w-100';

        for (let i = 1; i <= totalPages; i++) {
          const btn = document.createElement('button');
          btn.textContent = i;
          btn.className = 'btn btn-danger btn-lg border-5 rounded-0';
          btn.onclick = () => {
            currentPage = i;
            searchCharacters();
          };
          if (i === currentPage) {
            btn.style.fontWeight = 'bold';
          }
          wrapper.appendChild(btn);
        }

        // Centrar el wrapper usando un contenedor flex adicional
        const centerContainer = document.createElement('div');
        centerContainer.className = 'd-flex justify-content-center w-100';
        centerContainer.appendChild(wrapper);

        pagination.appendChild(centerContainer);
      }
    }
  </script>
</body>
</html>
